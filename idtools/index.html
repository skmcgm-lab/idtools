<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ’ å¯†é’¥æå– & è½¬æ¢ Â· Key Extract & Convert â€” åŒè¯­ç‰ˆ</title>
<style>
  body { background:#0b0b0b; color:#ffd966; font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif; padding:20px; }
  h1 { text-align:center; margin-bottom:8px; font-size:22px; }
  .container{max-width:980px;margin:0 auto;}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;align-items:center;}
  textarea{width:100%;height:160px;background:#111;border:1px solid:#333;color:#ffd966;padding:12px;font-family:monospace;font-size:14px;resize:vertical;}
  .btn{background:#111;border:1px solid:#b88a00;color:#ffd966;padding:8px 14px;border-radius:6px;cursor:pointer;}
  .btn:hover{background:#b88a00;color:#0b0b0b;box-shadow:0 6px 18px rgba(184,138,0,0.18);}
  .copy-btn{position:absolute;right:8px;top:8px;padding:6px 10px;font-size:12px}
  .result-wrap{position:relative;margin-bottom:18px;}
  label{margin-right:6px;color:#ffd966}
  .prefix-input{width:120px;padding:6px;background:#111;border:1px solid:#333;color:#ffd966;border-radius:6px;}
  footer{margin-top:18px;font-size:13px;color:#bfbfbf;text-align:center;}
  .note{font-size:13px;color:#e6c86b}
  .lang-btn{position:fixed;top:18px;right:18px;padding:8px 14px;font-size:13px;border-radius:6px;background:#111;border:1px solid:#b88a00;cursor:pointer;color:#ffd966;}

  /* ===== ç»Ÿè®¡é¢æ¿ ===== */
  .stat-box{
    background:#111; border:1px solid #b88a00; padding:10px 14px;
    border-radius:8px; margin-bottom:15px; line-height:22px; font-size:14px;
    color:#ffd966; display:flex; gap:18px; flex-wrap:wrap; align-items:center;
  }
  .stat-item{min-width:200px;}

  /* ===== Toast æç¤º ===== */
  .toast {
    position: fixed;
    top: 18px;
    right: 18px;
    background: #b88a00;
    color: #0b0b0b;
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(184,138,0,0.35);
    z-index: 9999;
    opacity: 0;
    transition: opacity .35s;
  }
</style>
</head>
<body>

<button id="langBtn" class="lang-btn">English</button>

<div class="container">
  <h1 id="title">ğŸ’ å¯†é’¥æå– & è½¬æ¢ (åŒè¯­ç‰ˆ)</h1>

  <div class="controls">
    <label for="prefix" id="labelPrefix">å‰ç¼€ï¼š</label>
    <input id="prefix" class="prefix-input" value="ID" />
    <label for="startNum" id="labelStart">èµ·å§‹ç¼–å·ï¼š</label>
    <input id="startNum" class="prefix-input" placeholder="å¦‚ 50 / 090 / 005" />
    <button class="btn" id="btnExtract" onclick="extract()">æå–</button>
    <button class="btn" id="btnConvert" onclick="convert()">è½¬æ¢</button>
    <button class="btn" id="btnClear" onclick="clearAll()">æ¸…ç©º</button>
    <button class="btn" id="btnDownload" onclick="downloadResult()">ä¸‹è½½</button>
  </div>

  <textarea id="inputText" placeholder="åœ¨æ­¤ç²˜è´´åŸå§‹æ•°æ®..."></textarea>

  <h2 id="statTitle">ç»Ÿè®¡é¢æ¿</h2>
  <div id="statPanel" class="stat-box">
    <div class="stat-item" id="statTotal">ğŸ“„ æ€»è¡Œæ•°ï¼š0</div>
    <div class="stat-item" id="statValid">ğŸŸ¢ æˆåŠŸæå–ï¼š0</div>
    <div class="stat-item" id="statInvalid">âš  æœªè¯†åˆ«è¡Œï¼š0</div>
  </div>

  <h2 id="exTitle">æå–ç»“æœ</h2>
  <div class="result-wrap">
    <button class="btn copy-btn" id="btnCopyExtract" onclick="copyResult('extracted')">ğŸ“‹ å¤åˆ¶</button>
    <textarea id="extracted" readonly></textarea>
  </div>

  <h2 id="cvTitle">è½¬æ¢ç»“æœ</h2>
  <div class="result-wrap">
    <button class="btn copy-btn" id="btnCopyConvert" onclick="copyResult('converted')">ğŸ“‹ å¤åˆ¶</button>
    <textarea id="converted" readonly></textarea>
  </div>

  <p class="note" id="note">æ”¯æŒæ‰€æœ‰æ ¼å¼ï¼Œä¿æŒé¡ºåºï¼Œè‡ªå®šä¹‰ç¼–å·ï¼Œè‡ªåŠ¨è¡¥é›¶ã€‚</p>
  <footer id="footer">ğŸ’ åŒè¯­ç»ˆæç‰ˆ Â· Bilingual Ultimate Edition</footer>
</div>

<script>
/* å¤šè¯­è¨€å­—å…¸ */
const lang={
  zh:{title:"ğŸ’ å¯†é’¥æå– & è½¬æ¢ (åŒè¯­ç‰ˆ)",prefix:"å‰ç¼€ï¼š",start:"èµ·å§‹ç¼–å·ï¼š",extract:"æå–",convert:"è½¬æ¢",clear:"æ¸…ç©º",download:"ä¸‹è½½",
      placeholder:"åœ¨æ­¤ç²˜è´´åŸå§‹æ•°æ®...",exTitle:"æå–ç»“æœ",cvTitle:"è½¬æ¢ç»“æœ",copy:"ğŸ“‹ å¤åˆ¶",note:"æ”¯æŒæ‰€æœ‰æ ¼å¼ï¼Œä¿æŒé¡ºåºï¼Œè‡ªå®šä¹‰ç¼–å·ï¼Œè‡ªåŠ¨è¡¥é›¶ã€‚",
      copied:"å·²å¤åˆ¶ï¼",noData:"è¯·å…ˆæå–æ•°æ®ï¼",noDownload:"æ²¡æœ‰å†…å®¹å¯ä¸‹è½½ï¼",footer:"ğŸ’ åŒè¯­ç»ˆæç‰ˆ Â· Bilingual Ultimate Edition",
      langBtn:"English",statTitle:"ç»Ÿè®¡é¢æ¿",st_total:"ğŸ“„ æ€»è¡Œæ•°ï¼š",st_valid:"ğŸŸ¢ æˆåŠŸæå–ï¼š",st_invalid:"âš  æœªè¯†åˆ«è¡Œï¼š"},
  en:{title:"ğŸ’ Key Extract & Convert (Bilingual Version)",prefix:"Prefix:",start:"Start No.:",extract:"Extract",convert:"Convert",clear:"Clear",download:"Download",
      placeholder:"Paste data here...",exTitle:"Extracted Result",cvTitle:"Converted Result",copy:"ğŸ“‹ Copy",note:"Supports all formats, keeps order, auto-numbering.",
      copied:"Copied!",noData:"Extract first!",noDownload:"No data!",footer:"ğŸ’ Bilingual Ultimate Edition",
      langBtn:"ä¸­æ–‡",statTitle:"Statistics",st_total:"ğŸ“„ Total Lines:",st_valid:"ğŸŸ¢ Extracted:",st_invalid:"âš  Unrecognized:"}};
let currentLang="zh";

/* åˆ‡æ¢è¯­è¨€ */
function applyLang(){
  const L=lang[currentLang];
  title.innerText=L.title;
  labelPrefix.innerText=L.prefix;
  labelStart.innerText=L.start;
  btnExtract.innerText=L.extract;
  btnConvert.innerText=L.convert;
  btnClear.innerText=L.clear;
  btnDownload.innerText=L.download;
  inputText.placeholder=L.placeholder;
  exTitle.innerText=L.exTitle;
  cvTitle.innerText=L.cvTitle;
  btnCopyExtract.innerText=L.copy;
  btnCopyConvert.innerText=L.copy;
  note.innerText=L.note;
  footer.innerText=L.footer;
  langBtn.innerText=L.langBtn;
  statTitle.innerText=L.statTitle;

  statTotal.innerText=L.st_total + (statTotal.dataset.val||0);
  statValid.innerText=L.st_valid + (statValid.dataset.val||0);
  statInvalid.innerText=L.st_invalid + (statInvalid.dataset.val||0);
}
langBtn.onclick=()=>{currentLang=currentLang==="zh"?"en":"zh";applyLang();};

/* æå– */
function extract(){
  const raw=inputText.value||'';
  const lines=raw.replace(/\r/g,'').trim().split(/\n+/).map(l=>l.trim()).filter(Boolean);
  let all=[]; let m;

  // åŒ¹é… block æ ¼å¼
  const block=/ID\s*[:=]\s*(\d+-\d+)[\s\S]*?Pass\s*[:=]\s*([A-Za-z0-9\-_]+)/gi;
  while((m=block.exec(raw))!==null) all.push(`${m[1]} ${m[2]}`);

  // åŒ¹é… csv
  lines.forEach(l=>{
    const csv=l.match(/^[A-Za-z0-9]+,\s*(\d+-\d+),\s*([A-Za-z0-9\-_]+)$/);
    if(csv) all.push(`${csv[1]} ${csv[2]}`);
  });

  // åŒ¹é… å•è¡Œ
  const single=/(\d+-\d+)[\s,=:+\/]+([A-Za-z0-9\-_]{8,})/g;
  while((m=single.exec(raw))!==null) all.push(`${m[1]} ${m[2]}`);

  // åŒ¹é… JSON
  const json=/"id"\s*:\s*"(\d+-\d+)"\s*,\s*"token"\s*:\s*"([A-Za-z0-9\-_]+)"/gi;
  while((m=json.exec(raw))!==null) all.push(`${m[1]} ${m[2]}`);

  let unique=[...new Set(all)].filter(r=>{
    const [id,token]=r.split(" ");
    return id.includes("-") && token.length>=16;
  });

  extracted.value=unique.join("\n");
  converted.value="";
  updateStats(lines.length,unique.length,lines.length-unique.length);
}

/* æ›´æ–°ç»Ÿè®¡ */
function updateStats(total,valid,invalid){
  const L=lang[currentLang];
  statTotal.dataset.val=total;
  statValid.dataset.val=valid;
  statInvalid.dataset.val=invalid;
  statTotal.innerText=L.st_total+total;
  statValid.innerText=L.st_valid+valid;
  statInvalid.innerText=L.st_invalid+invalid;
}

/* âœ… ä¿®å¤åçš„è½¬æ¢åŠŸèƒ½ */
function convert(){
  const text=document.getElementById("extracted").value.trim();
  if(!text){toast(lang[currentLang].noData);return;}

  const lines=text.split(/\n+/);

  const prefix=document.getElementById("prefix").value || "ID";
  let start=document.getElementById("startNum").value.trim();
  let startNo=parseInt(start||"1",10);

  const custom=start!==''; 
  const pad=(lines.length>=100?3:2);

  document.getElementById("converted").value = lines.map((line,i)=>{
    const [id,token]=line.split(/\s+/);
    const no=String(custom?(startNo+i):(i+1)).padStart(custom?start.length:pad,"0");
    return `${prefix}${no},${id},${token}`;
  }).join("\n");
}

/* æ¸…ç©º */
function clearAll(){
  inputText.value='';
  extracted.value='';
  converted.value='';
  updateStats(0,0,0);
}

/* å¤åˆ¶ */
function copyResult(id){
  const ta=document.getElementById(id);
  ta.select();
  document.execCommand("copy");
  toast(lang[currentLang].copied);
}

/* Toast */
function toast(msg){
  let div=document.createElement("div");
  div.className="toast";
  div.innerText=msg;
  document.body.appendChild(div);
  setTimeout(()=>div.style.opacity="1",20);
  setTimeout(()=>{div.style.opacity="0";setTimeout(()=>div.remove(),350);},1600);
}

/* ä¸‹è½½æ–‡ä»¶ */
function downloadResult(){
  let content=converted.value.trim();
  let name="";
  if(content){
    name=(prefix.value||"ID")+".txt";
  }else{
    content=extracted.value.trim();
    name="token.txt";
  }
  if(!content){toast(lang[currentLang].noDownload);return;}
  const blob=new Blob([content],{type:"text/plain;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}

applyLang();
updateStats(0,0,0);
</script>

</body>
</html>
